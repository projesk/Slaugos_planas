 <!DOCTYPE html>
<html lang="lt">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Paciento vertinimas ir slaugos planas</title>

<style>
  :root{
    --bg:#f7f8fa;--card:#ffffff;--muted:#6b7280;--line:#e5e7eb;
    --accent:#2563eb;--ok:#16a34a;--warn:#f59e0b;--bad:#dc2626;
  }
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;max-width:980px;margin:auto;padding:20px;background:var(--bg);color:#111}
  h1{margin:0 0 12px}
  .grid{display:grid;grid-template-columns:1fr;gap:14px}
  @media(min-width:860px){.grid{grid-template-columns:1fr 1fr}}
  .section{background:var(--card);border:1px solid var(--line);border-radius:10px;padding:14px}
  .section h2{font-size:18px;margin:0 0 10px;padding-bottom:8px;border-bottom:1px dashed var(--line)}
  label{display:block;margin-top:8px;font-weight:600}

  /* ====== LYGIAVIMO PATAISYMAI (kad laukai "neprasilenktÅ³") ====== */
  .row{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
    align-items:end;
  }
  .row > label{
    display:flex;
    flex-direction:column;
    justify-content:flex-end;
  }

  .hint{font-weight:400;color:var(--muted);font-size:12px;line-height:1.25}

  /* suvienodinam kontrolÄ—s aukÅ¡tÄ¯ */
  select,input{
    padding:10px;
    border:1px solid var(--line);
    border-radius:8px;
    width:100%;
    margin-top:6px;
    background:#fff;
    height:44px;
  }
  textarea{
    padding:10px;
    border:1px solid var(--line);
    border-radius:8px;
    width:100%;
    margin-top:6px;
    background:#fff;
    min-height:84px;
    resize:vertical;
    height:auto;
  }

  /* ====== iOS/Android SELECT suvienodinimas ====== */
  select{
    -webkit-appearance:none;
    appearance:none;
    padding-right:42px;
    background-repeat:no-repeat;
    background-position:right 14px center;
    background-size:12px 12px;
    background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24'%3E%3Cpath fill='%236b7280' d='M7 10l5 5l5-5z'/%3E%3C/svg%3E");
  }
  select::-ms-expand{display:none;}

  .checks{display:flex;gap:16px;flex-wrap:wrap;margin-top:8px}
  .checks label{display:flex;align-items:center;font-weight:500;margin:0}
  .checks input{margin-right:8px;width:auto;height:auto}

  .actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:14px}
  button{padding:10px 14px;border:none;border-radius:10px;background:var(--accent);color:#fff;cursor:pointer;font-weight:600}
  button.secondary{background:#fff;color:#111;border:1px solid var(--line)}
  button.good{background:var(--ok)}

  .results{background:var(--card);border:1px solid var(--line);border-radius:10px;padding:16px;margin-top:18px}
  .pill{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px;border:1px solid var(--line);margin:3px 6px 0 0;background:#fff}
  .pill.ok{border-color:#16a34a33;background:#16a34a18}
  .pill.warn{border-color:#f59e0b33;background:#f59e0b18}
  .pill.bad{border-color:#dc262633;background:#dc262618}

  .planas{border:1px solid var(--line);border-radius:10px;padding:10px;margin-top:10px;background:#fff}
  .planas h4{margin:0 0 8px}

  .status{padding:10px;border-radius:10px;margin-top:10px;display:none}
  .status.ok{display:block;background:#ecfdf5;border:1px solid #86efac;color:#065f46}
  .status.err{display:block;background:#fef2f2;border:1px solid #fecaca;color:#7f1d1d}

  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:12px;white-space:pre-wrap;background:#0b1220;color:#e5e7eb;border-radius:10px;padding:12px;margin-top:12px;overflow:auto}

  details.pv summary{list-style:none;cursor:pointer;display:flex;align-items:center;justify-content:space-between;font-weight:700;padding:4px 0}
  details.pv summary::-webkit-details-marker{display:none}
  details.pv summary::after{content:"â–¸";transition:transform .2s ease;font-weight:400}
  details.pv[open] summary::after{transform:rotate(90deg)}
  details.pv .pv-content{margin-top:10px}

  /* ===== DVPRS modal ===== */
  .modal{ position:fixed; inset:0; display:none; z-index:9999; }
  .modal[aria-hidden="false"]{ display:block; }
  .modal__backdrop{ position:absolute; inset:0; background:rgba(0,0,0,.45); }
  .modal__sheet{
    position:absolute; left:50%; top:50%;
    transform:translate(-50%,-50%);
    width:min(980px, calc(100vw - 18px));
    max-height:calc(100vh - 18px);
    overflow:auto;
    background:#fff; border:1px solid var(--line);
    border-radius:14px;
    -webkit-overflow-scrolling:touch;
  }
  .modal__header{
    position:sticky; top:0; background:#fff;
    display:flex; align-items:flex-start; justify-content:space-between;
    gap:12px; padding:14px; border-bottom:1px solid var(--line);
  }
  .modal__title{ font-weight:900; font-size:18px; }
  .modal__subtitle{ color:var(--muted); font-size:12px; margin-top:4px; line-height:1.3; }
  .modal__close{
    border:1px solid var(--line); background:#fff; border-radius:10px;
    width:40px; height:40px; cursor:pointer; font-weight:800;
  }
  .modal__footer{
    position:sticky; bottom:0; background:#fff;
    padding:12px 14px; border-top:1px solid var(--line);
    display:flex; justify-content:flex-end; gap:10px;
  }

  /* DVPRS grid - kaip lentelÄ— (0-10) */
  .dvprsGrid{
    padding:14px;
    display:grid;
    grid-template-columns:repeat(2, minmax(0, 1fr));
    gap:10px;
  }
  @media(min-width:720px){
    .dvprsGrid{ grid-template-columns:repeat(3, minmax(0, 1fr)); }
  }
  @media(min-width:980px){
    .dvprsGrid{ grid-template-columns:repeat(4, minmax(0, 1fr)); }
  }

  .dvprsCard{
    border:1px solid var(--line);
    border-radius:14px;
    padding:12px;
    background:#fff;
    cursor:pointer;
    text-align:left;
    overflow:hidden;
  }
  .dvprsCard:active{ transform:scale(0.99); }

  .dvprsBar{
    height:10px;
    border-radius:999px;
    margin-bottom:10px;
    background:var(--dvprsColor, #e5e7eb);
  }
  .dvprsTop{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
  }
  .dvprsLeft{
    display:flex;
    align-items:center;
    gap:10px;
  }
  .dvprsEmoji{
    font-size:26px;
    line-height:1;
  }
  .dvprsNum{
    font-size:24px;
    font-weight:900;
    line-height:1;
  }
  .dvprsTag{
    font-size:12px;
    color:var(--muted);
    white-space:nowrap;
  }
  .dvprsText{
    margin-top:10px;
    font-size:13px;
    line-height:1.25;
    font-weight:700;
    color:#111;
  }

  .dvprsLegend{
    padding:0 14px 14px;
    color:var(--muted);
    font-size:12px;
    line-height:1.3;
  }
</style>
</head>

<body>
<h1>Paciento vertinimas ir slaugos planas</h1>

<form id="nursingForm" novalidate>
  <div class="grid">

    <!-- IDENTIFIKACIJA -->
    <div class="section">
      <h2>Identifikacija</h2>
      <label for="palata">Palata
        <input id="palata" name="palata" autocomplete="off" />
      </label>
      <label for="lova">Lova
        <input id="lova" name="lova" autocomplete="off" />
      </label>
    </div>

    <!-- PACIENTO BÅªKLÄ– -->
    <div class="section">
      <h2>Paciento bÅ«klÄ—</h2>
      <div class="checks">
        <label><input type="checkbox" id="ramus" /> Ramus</label>
        <label><input type="checkbox" id="orientuotas" /> Orientuotas</label>
        <label><input type="checkbox" id="suvarzymas" /> SuvarÅ¾ymas</label>
      </div>
      <div class="hint">Jei nepaÅ¾ymÄ—ta â€“ Ä¯raÅ¡as bus: â€Pacientas: neramus, neorientuotasâ€œ.</div>
    </div>

    <!-- KVÄ–PAVIMO SISTEMA -->
    <div class="section">
      <h2>KvÄ—pavimo sistema</h2>

      <label for="trach">Tracheostominis vamzdis
        <select id="trach" name="trach">
          <option value="ne">NÄ—ra</option><option value="taip">Yra</option>
        </select>
      </label>

      <div class="row">
        <label for="sekretas_trach">Sekretas / atkosÄ—jimas iÅ¡ vamzdÅ¾io
          <select id="sekretas_trach" name="sekretas_trach">
            <option value="ne">Ne</option><option value="taip">Taip</option>
          </select>
        </label>

        <label for="siurbimas">Atliekamas siurbimas
          <select id="siurbimas" name="siurbimas">
            <option value="ne">Ne</option><option value="taip">Taip</option>
          </select>
        </label>
      </div>

      <div class="row">
        <label for="nosis">Nosis
          <select id="nosis" name="nosis">
            <option value="nedaryta">Niekas nedaryta</option>
            <option value="tamponuota">Tamponuota nosis</option>
            <option value="istraukti">IÅ¡traukti tamponai</option>
          </select>
        </label>

        <label for="dusulys">Ar jauÄiate dusulÄ¯?
          <select id="dusulys" name="dusulys">
            <option value="ne">Ne</option><option value="taip">Taip</option>
          </select>
        </label>
      </div>

      <div class="row">
        <label for="saturacija">Saturacija SpOâ‚‚ (%) <span class="hint">(50â€“100)</span>
          <input type="number" id="saturacija" name="saturacija" min="50" max="100" inputmode="decimal" />
        </label>

        <label for="kosulys">Kosulys
          <select id="kosulys" name="kosulys">
            <option value="nera">NÄ—ra</option><option value="sausas">Sausas</option><option value="dregnas">DrÄ—gnas</option>
          </select>
        </label>
      </div>
    </div>

    <!-- Å IRDIES IR KRAUJOTAKA -->
    <div class="section">
      <h2>Å irdies ir kraujotaka</h2>

      <div class="row">
        <label for="sistolinis">AKS (sistolinis) mmHg <span class="hint">(50â€“250)</span>
          <input type="number" id="sistolinis" name="sistolinis" min="50" max="250" />
        </label>

        <label for="diastolinis">AKS (diastolinis) mmHg <span class="hint">(20â€“150)</span>
          <input type="number" id="diastolinis" name="diastolinis" min="20" max="150" />
        </label>
      </div>

      <div class="row">
        <label for="pulsas">Pulsas (bpm) <span class="hint">(30â€“200)</span>
          <input type="number" id="pulsas" name="pulsas" min="30" max="200" />
        </label>

        <label for="temperatura">KÅ«no temperatÅ«ra (Â°C) <span class="hint">(30.0â€“42.0)</span>
          <input type="number" id="temperatura" name="temperatura" step="0.1" min="30" max="42" />
        </label>
      </div>

      <label for="svaigimas">Galvos svaigimas?
        <select id="svaigimas" name="svaigimas">
          <option value="ne">Ne</option><option value="taip">Taip</option>
        </select>
      </label>
    </div>

    <!-- MITYBA -->
    <div class="section">
      <h2>Mityba</h2>
      <div class="row">
        <label for="mityba">Mitybos bÅ«das
          <select id="mityba" name="mityba">
            <option value="burna">Per burnÄ…</option>
            <option value="peg">Per PEG</option>
            <option value="zondas">Per zondÄ…</option>
          </select>
        </label>

        <label for="rijimas">Rijimo sutrikimai?
          <select id="rijimas" name="rijimas">
            <option value="ne">Ne</option><option value="taip">Taip</option>
          </select>
        </label>
      </div>

      <label for="suvalgo">Ar suvalgo visÄ… maistÄ…?
        <select id="suvalgo" name="suvalgo">
          <option value="taip">Taip</option>
          <option value="dalis">Dalis</option>
          <option value="ne">Ne</option>
        </select>
      </label>
    </div>

    <!-- DIETA -->
    <div class="section">
      <h2>Dieta</h2>
      <label for="dieta_kodas">Pasirinkite dietÄ…</label>

      <select id="dieta_kodas" name="dieta_kodas">
        <option value="">â€” Pasirinkite â€”</option>
        <option value="P1">P1 (Ä®prasta)</option>
        <option value="PTM">PTM (MinkÅ¡tinta)</option>
        <option value="TM">TM (Tarkuota/trinta)</option>
        <option value="SM">SM (Skysto/enterinis)</option>
        <option value="CD">CD (Diabeto)</option>
        <option value="PTM-CD">PTM - CD (MinkÅ¡tinta + CD)</option>
        <option value="NPB">NPB (Nieko per burnÄ…)</option>
        <option value="P4">P4 (VegetarinÄ—)</option>
        <option value="Na">Na (MaÅ¾iau natrio)</option>
        <option value="B">B (BaltyminÄ—)</option>
        <option value="Lac">Lac (Be laktozÄ—s)</option>
        <option value="Sk(padid.)">Sk(padid.) (Daugiau skaidulÅ³)</option>
        <option value="Sk(maÅ¾.)">Sk(maÅ¾.) (MaÅ¾iau skaidulÅ³)</option>
        <option value="KITA">Kitaâ€¦</option>
      </select>

      <div id="dieta_kita_wrap" style="display:none; margin-top:10px">
        <label for="dieta_kita">Ä®raÅ¡ykite dietÄ… ranka</label>
        <input id="dieta_kita" placeholder="pvz., be glitimo, be kiauÅ¡iniÅ³..." />
        <div class="hint">â€Kitaâ€œ â€“ plane nieko nepridÄ—sime, tik konstatuosime dietÄ… Ä¯raÅ¡e.</div>
      </div>
    </div>

    <!-- Å ALINIMAS -->
    <div class="section">
      <h2>Å alinimas</h2>

      <div class="row">
        <label for="kateteris">Å lapimo kateteris
          <select id="kateteris" name="kateteris">
            <option value="nera">NÄ—ra</option><option value="yra">Yra</option>
          </select>
        </label>

        <label for="viduriai">ViduriÅ³ uÅ¾kietÄ—jimas?
          <select id="viduriai" name="viduriai">
            <option value="ne">Ne</option><option value="taip">Taip</option>
          </select>
        </label>
      </div>

      <label for="viduriavimas">Viduriavimas?
        <select id="viduriavimas" name="viduriavimas">
          <option value="ne">Ne</option><option value="taip">Taip</option>
        </select>
      </label>
    </div>

    <!-- JUDÄ–JIMAS -->
    <div class="section">
      <h2>JudÄ—jimas</h2>
      <label for="mobilumas">Mobilumas
        <select id="mobilumas" name="mobilumas">
          <option value="sav">SavarankiÅ¡kas</option>
          <option value="pagalba">Su pagalba</option>
          <option value="lova">Lovos reÅ¾imas</option>
        </select>
      </label>
    </div>

    <!-- MIEGAS -->
    <div class="section">
      <h2>Miegas</h2>
      <label for="miegas">Miego kokybÄ—
        <select id="miegas" name="miegas">
          <option value="gera">Gera</option>
          <option value="sutrikusi">Sutrikusi</option>
        </select>
      </label>
    </div>

    <!-- ODA -->
    <div class="section">
      <h2>Oda</h2>

      <div class="row">
        <label for="pragulos">Pragulos
          <select id="pragulos" name="pragulos">
            <option value="nera">NÄ—ra</option><option value="yra">Yra</option>
          </select>
        </label>

        <label for="zaizdos">Å½aizdos
          <select id="zaizdos" name="zaizdos">
            <option value="nera">NÄ—ra</option><option value="yra">Yra</option>
          </select>
        </label>
      </div>

      <div id="zaizdos_aprasymas" style="display:none;">
        <label for="zaizdos_text">Å½aizdos apraÅ¡ymas
          <textarea id="zaizdos_text" name="zaizdos_text" placeholder="Lokalizacija, dydis, sekrecija, paraudimas, skausmingumas..."></textarea>
        </label>
      </div>
    </div>

    <!-- SKAUSMAS -->
    <div class="section" id="skausmas_section">
      <h2>Skausmas</h2>

      <div class="row">
        <label for="skausmas">Ar yra skausmas?
          <select id="skausmas" name="skausmas">
            <option value="ne">Ne</option><option value="taip">Taip</option>
          </select>
        </label>

        <label for="skausmoLygis">Intensyvumas (0â€“10)
          <input type="number" id="skausmoLygis" name="skausmoLygis" min="0" max="10" />
        </label>
      </div>

      <div class="hint">Jei â€Yra skausmasâ€œ, Ä¯veskite 0â€“10 (NRS) arba naudokite DVPRS (pacientui).</div>

      <div class="actions" style="margin-top:10px">
        <button type="button" class="secondary" id="openDvprsBtn">Atidaryti DVPRS skalÄ™ pacientui</button>
      </div>
      <div class="hint">Pasirinkus DVPRS, balas automatiÅ¡kai Ä¯raÅ¡omas Ä¯ NRS laukÄ….</div>
    </div>

    <!-- KRAUJAVIMO RIZIKA -->
    <div class="section">
      <h2>Kraujavimo rizika</h2>
      <label for="kraujavimo_rizika">Kraujavimo rizika?
        <select id="kraujavimo_rizika" name="kraujavimo_rizika">
          <option value="nera">NÄ—ra</option>
          <option value="yra">Yra</option>
        </select>
      </label>
      <div class="hint">Jei â€Yraâ€œ â€“ plane: â€StebÄ—jimas dÄ—l galimo kraujavimoâ€œ, â€AKS sekimasâ€œ.</div>
    </div>

    <!-- PIRMINIS VERTINIMAS -->
    <div class="section" style="grid-column:1 / -1">
      <details class="pv" id="pv_section">
        <summary>Pirminis vertinimas <span class="hint">(spustelÄ—kite)</span></summary>
        <div class="pv-content">
          <div class="checks" style="margin-top:6px">
            <label><input type="checkbox" id="pv_cv"> Å irdiesâ€“kraujotakos</label>
            <label><input type="checkbox" id="pv_resp"> KvÄ—pavimo</label>
            <label><input type="checkbox" id="pv_endo_cd"> EndokrininÄ—s (CD)</label>
            <label><input type="checkbox" id="pv_renal_hep"> InkstÅ³/kepenÅ³</label>
          </div>

          <label style="margin-top:10px">InfekcinÄ—s ligos (Ä¯raÅ¡ykite)
            <input id="pv_infection" placeholder="pvz., MRSA, C. difficile, TB, COVID..." />
          </label>

          <label style="margin-top:10px">Alergijos
            <textarea id="pv_allergy" rows="2" placeholder="pvz., penicilinai, lateksas, maistas..."></textarea>
          </label>

          <div class="hint" style="margin-top:6px">
            PaÅ¾ymÄ—tos sritys automatiÅ¡kai pridÄ—s atitinkamas intervencijas prie bendro slaugos plano.
          </div>
        </div>
      </details>
    </div>

  </div>

  <div class="actions">
    <button type="button" id="genBtn" onclick="generateResults()">Generuoti</button>
    <button type="button" id="resetBtn" class="secondary">Naujas pacientas</button>
    <button type="button" class="good" onclick="keltiISistema()">Kelti Ä¯ sistemÄ…</button>
  </div>
</form>

<div id="results" class="results" aria-live="polite"></div>
<div id="statusOk" class="status ok">âœ… Duomenys Ä¯kelti sÄ—kmingai.</div>
<div id="statusErr" class="status err">âŒ Klaida siunÄiant Ä¯ Google Sheets. Patikrinkite WebApp adresÄ… ir leidimus.</div>

<!-- DVPRS MODAL -->
<div id="dvprsModal" class="modal" aria-hidden="true">
  <div class="modal__backdrop" id="dvprsCloseBackdrop"></div>

  <div class="modal__sheet" role="dialog" aria-modal="true" aria-labelledby="dvprsTitle">
    <div class="modal__header">
      <div>
        <div id="dvprsTitle" class="modal__title">DVPRS skausmo skalÄ— (0â€“10)</div>
        <div class="modal__subtitle">
          Pacientas pasirenka skaiÄiÅ³. Pasirinkimas automatiÅ¡kai Ä¯raÅ¡omas Ä¯ NRS laukÄ….
        </div>
      </div>
      <button type="button" class="modal__close" id="dvprsCloseBtn" aria-label="UÅ¾daryti">âœ•</button>
    </div>

    <div class="dvprsLegend">
      Spalvos ir veidukai padeda greiÄiau susiorientuoti. VertinimÄ… patvirtina paciento pasirinktas skaiÄius (0â€“10).
    </div>

    <div id="dvprsGrid" class="dvprsGrid"></div>

    <div class="modal__footer">
      <button type="button" class="secondary" id="dvprsCancelBtn">UÅ¾daryti</button>
    </div>
  </div>
</div>

<script>
/* â€”â€”â€” BENDRI â€”â€”â€” */
const $ = (id) => document.getElementById(id);
function onReady(fn){ if(document.readyState!=='loading') fn(); else document.addEventListener('DOMContentLoaded', fn); }

/* â€”â€”â€” Ä®KLIJUOK SAVO WebApp /exec URL â€”â€”â€” */
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxODAbmdrmccCYCUkswsFgnz-nrC8clEQQf-5kId3y-3TCqUwsU4pyCze2Jojv43VV_1A/exec";

/* â€”â€”â€” PLANÅ² Å½EMÄ–LAPIS â€”â€”â€” */
const slaugosPlanas = {
  "KvÄ—pavimo takai su tracheostominiu vamzdÅ¾iu": [
    "Savalaikis atsiurbimas iÅ¡ tracheostominio vamzdelio",
    "Vamzdelio drÄ—kinimas",
    "Palatos oro drÄ—kinimas",
    "Sekreto (kiekio/spalvos/klampumo) vertinimas ir dokumentavimas",
    "Stomos prieÅ¾iÅ«ra â€“ tvarsÄio keitimas bent 2 kartus per parÄ…",
    "Tracheostominio vamzdelio fiksacijos patikra"
  ],
  "Nedidelis kraujavimas iÅ¡ nosies": [
    "AKS stebÄ—jimas kraujavimui nestojant",
    "Pacientas apmokintas kaip priÅ¾iÅ«rÄ—ti nosÄ¯ kraujavimui sustojus"
  ],
  "Sutrikusi kvÄ—pavimo funkcija (dusulys)": [
    "SpOâ‚‚ stebÄ—jimas",
    "Prireikus Oâ‚‚ skyrimas pagal SpOâ‚‚"
  ],
  "Neefektyvi dujÅ³ apykaita": [
    "SpOâ‚‚ stebÄ—jimas",
    "Oâ‚‚ skyrimas ir reguliavimas pagal SpOâ‚‚ duomenis"
  ],
  "PaÅ¾emÄ—jÄ™s kraujo spaudimas": [
    "Patarta neskubÄ—ti keltis, pasÄ—dÄ—ti nuleidus kojas prieÅ¡ einant",
    "StebÄ—jimas dÄ—l galimÅ³ griuvimÅ³",
    "AKS matavimas po 1 val."
  ],
  "PadidÄ—jÄ™s kraujo spaudimas": [
    "AKS sekimas kas 4 val."
  ],
  "Sutrikusi mityba per burnÄ…": [
    "StebÄ—jimas dÄ—l aspiracijos",
    "Pagalba valgant",
    "Reikalui esant maisto tirÅ¡tinimas"
  ],
  "Mityba per zondÄ… (NG)": [
    "Zondo padÄ—ties patikra pagal Ä¯staigos protokolÄ…",
    "GalvÅ«galis â‰¥30â€“45Â° maitinimo metu ir 30â€“60 min po",
    "Zondo praplovimas prieÅ¡ ir po maitinimo bei vaistÅ³",
    "Nosies ir odos prie zondo prieÅ¾iÅ«ra, fiksacijos patikra",
    "StebÄ—ti dÄ—l aspiracijos, pykinimo, pilvo pÅ«timo"
  ],
  "Mityba per PEG": [
    "PEG vietos apÅ¾iÅ«ra ir tvarsÄio keitimas",
    "Praplovimas prieÅ¡ ir po maitinimo bei vaistÅ³",
    "GalvÅ«galis â‰¥30â€“45Â° maitinimo metu ir 30â€“60 min po"
  ],
  "Rizika griuvimui dÄ—l pagalbos poreikio": [
    "StebÄ—ti dÄ—l griuvimÅ³ rizikos, kviesti pagalbÄ… judant"
  ],
  "Rizika praguloms dÄ—l lovos reÅ¾imo": [
    "PadÄ—ties keitimas kas 3 val.",
    "PakiÅ¡amÅ³ indÅ³/sauskelniÅ³ naudojimas",
    "PagalbiniÅ³ priemoniÅ³ naudojimas",
    "Odos vientisumo stebÄ—jimas"
  ],
  "Pragulos": [
    "KÅ«no padÄ—ties keitimas kas 3 val.",
    "PagalbinÄ—s priemonÄ—s",
    "Pragulos perriÅ¡imas pagal Å¾aizdÅ³ prieÅ¾iÅ«ros planÄ…"
  ],
  "Odos vientisumo paÅ¾eidimas (Å¾aizda)": [
    "Å½aizdos perriÅ¡imas",
    "StebÄ—ti infekcijos poÅ¾ymius"
  ],
  "Nedidelis skausmas (1â€“3/10)": [
    "Nefarmakologinis skausmo malÅ¡inimas",
    "Pacientui norint â€“ farmakologinis nuskausminimas"
  ],
  "Vidutinis skausmas (4â€“6/10)": [
    "Savalaikis nuskausminimas pagal gydytojo paskyrimÄ…",
    "Pakartotinis skausmo matavimas po 30 min. po vaistÅ³ suleidimo/sudavimo"
  ],
  "Didelis skausmas (7â€“10/10)": [
    "Skubus nuskausminimas pagal gydytojo paskyrimÄ…",
    "Pakartotinis skausmo matavimas po 15 min."
  ],
  "Å lapimo kateteris": [
    "Kateterio prieÅ¾iÅ«ra pagal Ä¯staigos protokolÄ…",
    "StebÄ—ti diurezÄ™ ir Å¡lapimo pobÅ«dÄ¯",
    "StebÄ—ti infekcijos poÅ¾ymius"
  ],
  "ViduriÅ³ uÅ¾kietÄ—jimas": [
    "StebÄ—ti tuÅ¡tinimÄ…si",
    "SkysÄiÅ³/aktyvumo skatinimas pagal bÅ«klÄ™",
    "PriemoniÅ³ taikymas pagal paskyrimÄ…"
  ],
  "Viduriavimas": [
    "StebÄ—ti tuÅ¡tinimÄ…si",
    "Odos prieÅ¾iÅ«ra tarpvietÄ—je",
    "SkysÄiÅ³ balanso stebÄ—jimas"
  ],
 "SutrikÄ™s miegas": [
  "Aplinkos veiksniÅ³ korekcija (triukÅ¡mas, Å¡viesa, temperatÅ«ra)",
  "Skausmo vertinimas prieÅ¡ miegÄ…",
  "NefarmakologiniÅ³ miego gerinimo priemoniÅ³ taikymas",
],

  "PadidÄ—jusi temperatÅ«ra": ["TemperatÅ«ros stebÄ—jimas"],
  "Hipotermija": ["Å ilumos palaikymas","TemperatÅ«ros stebÄ—jimas"],
  "Kraujavimo rizika": ["StebÄ—jimas dÄ—l galimo kraujavimo","AKS sekimas"]
};

const dietPlan = {
  "P1": [],
  "P4": [],
  "PTM":   ["Stebima, kaip pacientui pavyksta nuryti maistÄ…, bei dÄ—l aspiracijos rizikos."],
  "TM":    ["Stebima, kaip pacientui pavyksta nuryti maistÄ…, bei dÄ—l aspiracijos rizikos."],
  "SM":    ["Pacientas maitinamas maÅ¾ais boliusais, lÄ—tai; stebima dÄ—l aspiracijos rizikos."],
  "CD":    ["Sekama glikemija."],
  "PTM-CD":["Stebima, kaip pacientui pavyksta nuryti maistÄ…, bei dÄ—l aspiracijos rizikos; sekama glikemija."],
  "Na":    ["Stebima dÄ—l edemÅ³, pastebÄ—jus â€“ AKS ir skysÄiÅ³ sekimas."],
  "Sk(padid.)": ["Stebima dÄ—l pilvo pÅ«timo ir tuÅ¡tinimosi."],
  "Sk(maÅ¾.)":   ["Stebima dÄ—l pilvo pÅ«timo ir tuÅ¡tinimosi."],
  "B": [],
  "Lac": [],
  "NPB": ["Pacientas nieko nevalgo ir negeria, kol kitaip nenurodÄ— gydytojas."]
};

const restraintPlan = [
  "Taikoma fizinio suvarÅ¾ymo priemonÄ—s, imobilizuota galÅ«nÄ— atlaisvinama kas 1,5 val. (eHL pildomas paciento, kuriam taikomas fizinio suvarÅ¾ymo priemonÄ—s, stebÄ—jimo lapas)",
  "Stebimos gyvybinÄ—s funkcijos",
  "PragulÅ³ profilaktika",
  "Pagalba valgant ir geriant, atliekant asmens higienÄ…, Å¡lapinantis ar tuÅ¡tinantis"
];

let lastPayload = null;

function toNum(v){ const n=parseFloat(v); return isFinite(n)?n:null; }
function calcMAP(sys,dia){ if(sys==null||dia==null) return null; return Math.round(((2*dia)+sys)/3); }
function valOrDash(v){ return (v==null||v==="")?"-":v; }
function escapeHtml(s){ return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;"); }
function classifyPill(text,severity="ok"){ const cls=severity==="bad"?"pill bad":severity==="warn"?"pill warn":"pill ok"; return `<span class="${cls}">${text}</span>`; }
function vitalsText(spo2,sys,dia,map,hr,temp){
  const aks=(sys!=null&&dia!=null)?`${sys}/${dia} mmHg${map!=null?` (MAP ${map})`:''}`:'-';
  const T=(temp!=null)?`${Number(temp).toFixed(1)} Â°C`:'-';
  return [`SpOâ‚‚: ${spo2!=null?spo2+' %':'-'}`,`AKS: ${aks}`,`Å SD: ${hr!=null?hr+'/min':'-'}`,`TemperatÅ«ra: ${T}`].join('\n');
}

/* ===== DVPRS: apraÅ¡ai + spalvos + veidukai (kaip Wordâ€™e) ===== */
const dvprs = [
  {n:0, emoji:"ğŸ˜€", color:"#16a34a", text:"NERA SKAUSMO"},
  {n:1, emoji:"ğŸ™‚", color:"#22c55e", text:"NEPASTEBIMAS SKAUSMAS"},
  {n:2, emoji:"ğŸ™‚", color:"#4ade80", text:"PASTEBIMAS SKAUSMAS, NEKELIANTIS NEPATOGUMÅ²"},
  {n:3, emoji:"ğŸ˜", color:"#a3e635", text:"SKAUSMAS KURIS KARTAIS NELEIDÅ½IA SUSIKAUPTI"},
  {n:4, emoji:"ğŸ˜", color:"#facc15", text:"SKAUSMAS KURIS NELEIDÅ½IA SUSIKAUPTI"},
  {n:5, emoji:"ğŸ˜£", color:"#f59e0b", text:"SKAUSMAS KURIS TRUKDO VEIKLOMS"},
  {n:6, emoji:"ğŸ˜£", color:"#fb923c", text:"SUNKU IGNORUOTI SKAUSMÄ„"},
  {n:7, emoji:"ğŸ˜«", color:"#f97316", text:"SUNKU SUSIKAUPTI DÄ–L SKAUSMO"},
  {n:8, emoji:"ğŸ˜«", color:"#ef4444", text:"DÄ–L SKAUSMO SUNKU KÄ„ NORS DARYTI"},
  {n:9, emoji:"ğŸ˜­", color:"#dc2626", text:"NEPAKELIAMAS SKAUSMAS, NIEKO NEÄ®MANOMA DARYTI"},
  {n:10, emoji:"ğŸ˜­", color:"#991b1b", text:"DIDÅ½IAUSIAS SKAUSMAS, NIEKAS DAUGIAU NERÅªPI"}
];

function openDvprs(){
  $('dvprsModal').setAttribute('aria-hidden','false');
  document.body.style.overflow='hidden';
}
function closeDvprs(){
  $('dvprsModal').setAttribute('aria-hidden','true');
  document.body.style.overflow='';
}
function setPainFromDvprs(n){
  $('skausmas').value='taip';
  $('skausmoLygis').value=String(n);
  $('skausmoLygis').toggleAttribute('required', true);
  closeDvprs();
  $('skausmas_section')?.scrollIntoView({behavior:'smooth', block:'start'});
}
function renderDvprs(){
  const grid=$('dvprsGrid');
  if(!grid) return;
  grid.innerHTML = dvprs.map(item => `
    <button type="button" class="dvprsCard" style="--dvprsColor:${item.color}" onclick="setPainFromDvprs(${item.n})">
      <div class="dvprsBar"></div>
      <div class="dvprsTop">
        <div class="dvprsLeft">
          <div class="dvprsEmoji" aria-hidden="true">${item.emoji}</div>
          <div class="dvprsNum">${item.n}</div>
        </div>
        <div class="dvprsTag">${item.n}/10</div>
      </div>
      <div class="dvprsText">${escapeHtml(item.text)}</div>
    </button>
  `).join("");
}

onReady(() => {
  $('zaizdos')?.addEventListener('change', e => { $('zaizdos_aprasymas').style.display = e.target.value === 'yra' ? 'block' : 'none'; });
  $('skausmas')?.addEventListener('change', e => { $('skausmoLygis')?.toggleAttribute('required', e.target.value === 'taip'); });
  $('resetBtn')?.addEventListener('click', resetForm);
  $('dieta_kodas')?.addEventListener('change', () => { $('dieta_kita_wrap').style.display = ($('dieta_kodas').value === 'KITA') ? 'block' : 'none'; });

  renderDvprs();
  $('openDvprsBtn')?.addEventListener('click', openDvprs);
  $('dvprsCloseBtn')?.addEventListener('click', closeDvprs);
  $('dvprsCancelBtn')?.addEventListener('click', closeDvprs);
  $('dvprsCloseBackdrop')?.addEventListener('click', closeDvprs);

  document.addEventListener('keydown', (e) => {
    if(e.key === 'Escape' && $('dvprsModal')?.getAttribute('aria-hidden') === 'false') closeDvprs();
  });
});

/* â€”â€”â€” GENERAVIMAS â€”â€”â€” */
function generateResults(){
  $('statusOk').style.display='none';
  $('statusErr').style.display='none';

  const f=document.forms['nursingForm'];
  const esamos=[], galimos=[], pills=[];

  const spo2=toNum(f['saturacija'].value);
  const temp=toNum(f['temperatura'].value);
  const sys=toNum(f['sistolinis'].value);
  const dia=toNum(f['diastolinis'].value);
  const hr=toNum(f['pulsas'].value);
  const map=calcMAP(sys,dia);

  const highSys30 = (sys!=null && sys>165);

  if(spo2!=null){
    if(spo2<90){ esamos.push("Neefektyvi dujÅ³ apykaita"); pills.push(classifyPill(`SpOâ‚‚ ${spo2}% (kritiÅ¡kai Å¾ema)`,"bad")); }
    else if(spo2<95){ esamos.push("Neefektyvi dujÅ³ apykaita"); pills.push(classifyPill(`SpOâ‚‚ ${spo2}% (Å¾ema)`,"warn")); }
    else pills.push(classifyPill(`SpOâ‚‚ ${spo2}%`,"ok"));
  }

  if(temp!=null){
    if(temp>=38.0){ esamos.push("PadidÄ—jusi temperatÅ«ra"); pills.push(classifyPill(`T ${temp.toFixed(1)}Â°C (karÅ¡Äiavimas)`,"warn")); }
    else if(temp>=37.1){ esamos.push("PadidÄ—jusi temperatÅ«ra"); pills.push(classifyPill(`T ${temp.toFixed(1)}Â°C (subfebrilus)`,"warn")); }
    else if(temp<35.6){ esamos.push("Hipotermija"); pills.push(classifyPill(`T ${temp.toFixed(1)}Â°C (Å¾ema)`,"warn")); }
    else pills.push(classifyPill(`T ${temp.toFixed(1)}Â°C`,"ok"));
  }

  if(f['trach'].value==='taip' || f['sekretas_trach'].value==='taip' || f['siurbimas'].value==='taip'){
    esamos.push("KvÄ—pavimo takai su tracheostominiu vamzdÅ¾iu");
  }

  if(f['nosis'].value==='istraukti') esamos.push("Nedidelis kraujavimas iÅ¡ nosies");
  if(f['dusulys'].value==='taip') esamos.push("Sutrikusi kvÄ—pavimo funkcija (dusulys)");

  if(sys!=null && dia!=null){
    if(sys<100 || (map!=null && map<65)) esamos.push("PaÅ¾emÄ—jÄ™s kraujo spaudimas");
    if(sys>=140 || dia>=90) esamos.push("PadidÄ—jÄ™s kraujo spaudimas");
  }

  if(map!=null) pills.push(classifyPill(`MAP ${map} mmHg`,(map<65)?"bad":(map<75)?"warn":"ok"));
  if(sys!=null&&dia!=null) pills.push(classifyPill(`AKS ${sys}/${dia} mmHg`,(sys>=140||dia>=90)?"warn":(sys<100)?"warn":"ok"));
  if(highSys30) pills.push(classifyPill(`SYS ${sys} mmHg (>165) â€“ kas 30 min.`,"warn"));

  if(hr!=null){
    if(hr>100) pills.push(classifyPill(`Pulsas ${hr}/min (tachikardija)`,"warn"));
    else if(hr<50) pills.push(classifyPill(`Pulsas ${hr}/min (bradikardija)`,"warn"));
    else pills.push(classifyPill(`Pulsas ${hr}/min`,"ok"));
  }

  const m=f['mityba'].value;
  if(m==='peg') esamos.push("Mityba per PEG");
  else if(m==='zondas') esamos.push("Mityba per zondÄ… (NG)");
  else if(m==='burna'){
    if(f['rijimas'].value==='taip' || f['suvalgo'].value!=='taip') esamos.push("Sutrikusi mityba per burnÄ…");
  }

  if(f['kateteris'].value==='yra') esamos.push("Å lapimo kateteris");
  if(f['viduriai'].value==='taip') esamos.push("ViduriÅ³ uÅ¾kietÄ—jimas");
  if(f['viduriavimas'].value==='taip') esamos.push("Viduriavimas");
 
/* ===== MIEGAS ===== */
if (f['miegas'] && f['miegas'].value === 'sutrikusi') {
  esamos.push("SutrikÄ™s miegas");
}

  if(f['mobilumas'].value==='lova') galimos.push("Rizika praguloms dÄ—l lovos reÅ¾imo");
  if(f['mobilumas'].value==='pagalba') galimos.push("Rizika griuvimui dÄ—l pagalbos poreikio");
  if(f['pragulos'].value==='yra') esamos.push("Pragulos");
  if(f['zaizdos'].value==='yra'){
    const apr=(f['zaizdos_text'].value||'').trim();
    esamos.push("Odos vientisumo paÅ¾eidimas (Å¾aizda)"+(apr?(" â€“ "+apr):""));
  }

  if(f['skausmas'].value==='taip'){
    const val=toNum(f['skausmoLygis'].value);
    if(val==null || val<0 || val>10){ alert("Ä®veskite skausmo intensyvumÄ… (0â€“10)."); $('skausmoLygis').focus(); return; }

    let painLabel="";
    if(val>=1 && val<=3) painLabel="Nedidelis skausmas (1â€“3/10)";
    else if(val>=4 && val<=6) painLabel="Vidutinis skausmas (4â€“6/10)";
    else if(val>=7 && val<=10) painLabel="Didelis skausmas (7â€“10/10)";
    else painLabel="Skausmas (0/10)";

    if(val>0) esamos.push(painLabel);

    const sev=val>=7 ? "bad" : val>=4 ? "warn" : "ok";
    pills.push(classifyPill(`Skausmas ${val}/10`,sev));
  }

  if(f['kraujavimo_rizika'].value==='yra') galimos.push("Kraujavimo rizika");

  const uniq=a=>[...new Set(a)].filter(Boolean);
  const esamosU=uniq(esamos).sort();
  const galimosU=uniq(galimos).sort();

  const pb_ramus  = $('ramus').checked;
  const pb_orient = $('orientuotas').checked;
  const psichoTekstas = `${pb_ramus ? 'ramus' : 'neramus'}, ${pb_orient ? 'orientuotas' : 'neorientuotas'}`;

  const isRestrained = $('suvarzymas')?.checked === true;
  const nowTime = new Date().toLocaleTimeString('lt-LT', {hour:'2-digit', minute:'2-digit'});
  const restraintSentence = isRestrained
    ? `DÄ—l galimos Å¾alos sau paÄiam ir aplinkiniams, neveikiant kitoms priemonÄ—ms pacientas fiksuotas (${nowTime}).`
    : "";

  const pvPlanSets={
    cv:["AKS sekimas","SkysÄiÅ³ balanso stebÄ—jimas","EdemÅ³ stebÄ—jimas","Dusulio stebÄ—jimas","Mitybos/dietos pritaikymas"],
    resp:["SpOâ‚‚ stebÄ—jimas"],
    endo:["Glikemijos kontrolÄ—","Mitybos/dietos pritaikymas"],
    rh:["SkysÄiÅ³ balanso stebÄ—jimas","SkysÄiÅ³ kiekio sekimas","AKS sekimas"]
  };
  const pvSelected=[], pvExtraItems=[];
  if($('pv_cv')?.checked){ pvSelected.push("Å irdiesâ€“kraujotakos"); pvExtraItems.push(...pvPlanSets.cv); }
  if($('pv_resp')?.checked){ pvSelected.push("KvÄ—pavimo"); pvExtraItems.push(...pvPlanSets.resp); }
  if($('pv_endo_cd')?.checked){ pvSelected.push("EndokrininÄ—s (CD)"); pvExtraItems.push(...pvPlanSets.endo); }
  if($('pv_renal_hep')?.checked){ pvSelected.push("InkstÅ³/kepenÅ³"); pvExtraItems.push(...pvPlanSets.rh); }
  const pvInfection=($('pv_infection')?.value||'').trim();
  const pvAllergy=($('pv_allergy')?.value||'').trim();
  const pvSummaryParts=[];
  if(pvSelected.length) pvSummaryParts.push("Sritys: "+pvSelected.join(", "));
  if(pvInfection) pvSummaryParts.push("InfekcinÄ—s ligos: "+pvInfection);
  if(pvAllergy) pvSummaryParts.push("Alergijos: "+pvAllergy);
  const pvSummaryText=pvSummaryParts.join(" | ");

  const dietCode=($('dieta_kodas')?.value||'').trim();
  const dietCustom=(dietCode==='KITA')?(($('dieta_kita')?.value||'').trim()):'';
  const hasDiet=(dietCode && dietCode!=='KITA') || (dietCode==='KITA' && dietCustom);

  let html="";
  if(pills.length) html+=`<div class="hint"><strong>Greita santrauka:</strong> ${pills.join(" ")}</div>`;
  html+=`<h3>Esamos problemos</h3><ul>${esamosU.length?esamosU.map(p=>`<li>${escapeHtml(p)}</li>`).join(""):"<li>NepastebÄ—ta</li>"}</ul>`;
  html+=`<h3>Galimos problemos</h3><ul>${galimosU.length?galimosU.map(p=>`<li>${escapeHtml(p)}</li>`).join(""):"<li>NepastebÄ—ta</li>"}</ul>`;

  html+=`<h3>Slaugos planas</h3>`;
  [...esamosU,...galimosU].forEach(p=>{
    const key=Object.keys(slaugosPlanas).find(k=>p.startsWith(k));
    if(key){
      const items=[...slaugosPlanas[key]];
      if(p.startsWith("PadidÄ—jÄ™s kraujo spaudimas") && highSys30){
        items.push("AKS sekimas kas 30 min.");
      }
      html+=`<div class="planas"><h4>${escapeHtml(p)}</h4><ul>${items.map(i=>`<li>${escapeHtml(i)}</li>`).join("")}</ul></div>`;
    }
  });

  const dietItems=(dietCode && dietCode!=='KITA') ? (dietPlan[dietCode]||[]) : [];
  if(dietItems.length){
    html+=`<div class="planas"><h4>Dieta: ${escapeHtml(dietCode)}</h4><ul>${dietItems.map(i=>`<li>${escapeHtml(i)}</li>`).join("")}</ul></div>`;
  }

  if(isRestrained){
    html+=`<div class="planas"><h4>Fizinis suvarÅ¾ymas</h4><ul>${restraintPlan.map(i=>`<li>${escapeHtml(i)}</li>`).join("")}</ul></div>`;
  }

  const aksStr=(sys!=null&&dia!=null)?`${sys} / ${dia} mmHg${map!=null?` (MAP ${map})`:''}`:'-';
  html+=`<h3>Ä®vesti gyvybiniai rodikliai</h3>
  <p><strong>SpOâ‚‚:</strong> ${valOrDash(spo2)} %<br>
  <strong>AKS:</strong> ${aksStr}<br>
  <strong>Å SD:</strong> ${valOrDash(hr)} / min<br>
  <strong>TemperatÅ«ra:</strong> ${temp!=null?temp.toFixed(1):"-"} Â°C</p>
  <p><strong>Pacientas:</strong> ${escapeHtml(psichoTekstas)}</p>`;

  if (restraintSentence) html += `<p>${escapeHtml(restraintSentence)}</p>`;
  if(hasDiet){
    const dietaUi=(dietCode==='KITA')?dietCustom:dietCode;
    html+=`<p><strong>Pacientui skirta:</strong> ${escapeHtml(dietaUi)} dieta</p>`;
  }
  html+=`<p><strong>Pirminis vertinimas:</strong> ${escapeHtml(pvSummaryText || "â€”")}</p>`;

  $('results').innerHTML=html;

  const seenPlan=new Set(); const planItems=[];
  [...esamosU,...galimosU].forEach(p=>{
    const key=Object.keys(slaugosPlanas).find(k=>p.startsWith(k));
    if(!key) return;
    slaugosPlanas[key].forEach(it=>{ if(!seenPlan.has(it)){ seenPlan.add(it); planItems.push(it); } });
    if(p.startsWith("PadidÄ—jÄ™s kraujo spaudimas") && highSys30){
      const it="AKS sekimas kas 30 min.";
      if(!seenPlan.has(it)){ seenPlan.add(it); planItems.push(it); }
    }
  });

  if(dietCode && dietCode!=='KITA'){
    (dietPlan[dietCode]||[]).forEach(it=>{ if(!seenPlan.has(it)){ seenPlan.add(it); planItems.push(it); } });
  }
  if(isRestrained){
    restraintPlan.forEach(it=>{ if(!seenPlan.has(it)){ seenPlan.add(it); planItems.push(it); } });
  }
  if(pvExtraItems.length){
    pvExtraItems.forEach(it=>{ if(!seenPlan.has(it)){ seenPlan.add(it); planItems.push(it); } });
  }

  const planasText=planItems.length?planItems.map(i=>"â€¢ "+i).join("\n"):"-";
  const gyvybiniai=vitalsText(spo2,sys,dia,map,hr,temp);
  const slaugosProb=esamosU.length?esamosU.join('; '):'-';
  const galimosProb=galimosU.length?galimosU.join('; '):'-';

  let irasas=
    `Gyvybiniai rodikliai:\n${gyvybiniai}\n\n`+
    `Pacientas: ${psichoTekstas}\n`;
  if (restraintSentence) irasas += `${restraintSentence}\n`;
  irasas += `\n`;
  if(hasDiet){
    const dietaNote=(dietCode==='KITA')?dietCustom:dietCode;
    irasas+=`Pacientui skirta: ${dietaNote} dieta\n\n`;
  }
  irasas+=
    `Pirminis vertinimas:\n${pvSummaryText || "â€”"}\n\n`+
    `Slaugos problemos:\n${slaugosProb}\n\n`+
    `Galimos problemos:\n${galimosProb}\n\n`+
    `Slaugos planas:\n${planasText}`;

  lastPayload={
    "Laikas": new Date().toLocaleString('lt-LT'),
    "palata": f['palata'].value.trim(),
    "lova":   f['lova'].value.trim(),
    "Ä¯raÅ¡as": irasas
  };

  $('results').insertAdjacentHTML('beforeend', `<div class="mono">${escapeHtml(JSON.stringify(lastPayload,null,2))}</div>`);
}

/* â€”â€”â€” SIUNTIMAS Ä® SHEETS â€”â€”â€” */
function keltiISistema(){
  if(!lastPayload){ alert("Pirmiausia paspauskite â€Generuotiâ€œ."); return; }
  const url=(GOOGLE_SCRIPT_URL||'').trim();
  if(!url || !url.endsWith('/exec')){ alert("Patikrinkite WebApp URL â€“ turi baigtis /exec."); return; }

  fetch(url,{method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify(lastPayload),mode:"no-cors"})
  .then(()=>{ $('statusErr').style.display='none'; $('statusOk').style.display='block'; })
  .catch(()=>{ $('statusOk').style.display='none'; $('statusErr').style.display='block'; });
}

/* â€”â€”â€” RESET â€”â€”â€” */
function resetForm(){
  $('nursingForm').reset();
  $('results').innerHTML="";
  $('statusOk').style.display='none';
  $('statusErr').style.display='none';
  $('zaizdos_aprasymas').style.display='none';
  $('dieta_kita_wrap').style.display='none';
  closeDvprs();
  lastPayload=null;
}
</script>
</body>
</html>

