<!DOCTYPE html>
<html lang="lt">
<head>
<meta charset="UTF-8">
<title>Paciento vertinimas ir slaugos planas</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 950px; margin: auto; padding: 20px; }
  .section { margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; background: #f9f9f9; }
  h2 { border-bottom: 1px solid #ccc; padding-bottom: 5px; }
  label { display: block; margin-top: 8px; }
  select, input, textarea { padding: 5px; margin-top: 4px; width: 100%; box-sizing: border-box; }
  button { padding: 10px 15px; background: #2c7; border: none; cursor: pointer; margin-top: 10px; }
  button:hover { background: #29a; color: white; }
  .results { background: #f0f0f0; padding: 15px; margin-top: 20px; border-radius: 4px; }
  .planas { background: #fff; border: 1px solid #ccc; margin-top: 15px; padding: 10px; }
  .planas h4 { margin: 5px 0; }
</style>
</head>
<body>

<h1>Paciento vertinimas ir slaugos planas</h1>

<form id="nursingForm">

<!-- IDENTIFIKACIJA -->
<div class="section">
<h2>Identifikacija</h2>
<label>Palata: <input type="text" name="palata"></label>
<label>Lova: <input type="text" name="lova"></label>
</div>

<!-- KVĖPAVIMO SISTEMA -->
<div class="section">
<h2>Kvėpavimo sistema</h2>
<label>Tracheostominis vamzdis:
<select name="trach"><option value="ne">Nėra</option><option value="taip">Yra</option></select></label>
<label>Atkosėjimas ar sekretas iš vamzdžio:
<select name="sekretas_trach"><option value="ne">Ne</option><option value="taip">Taip</option></select></label>
<label>Atliekamas siurbimas:
<select name="siurbimas"><option value="ne">Ne</option><option value="taip">Taip</option></select></label>
<label>Nosis:
<select name="nosis">
<option value="nedaryta">Niekas nedaryta</option>
<option value="tamponuota">Tamponuota nosis</option>
<option value="istraukti">Ištraukti tamponai</option>
</select></label>
<label>Ar jaučiate dusulį?
<select name="dusulys"><option value="ne">Ne</option><option value="taip">Taip</option></select></label>
<label>Saturacija (%) <input type="number" name="saturacija" min="50" max="100"></label>
<label>Kosulys:
<select name="kosulys"><option value="nera">Nėra</option><option value="sausas">Sausas</option><option value="dregnas">Drėgnas</option></select></label>
</div>

<!-- ŠIRDIES IR KRAUJOTAKA -->
<div class="section">
<h2>Širdies ir kraujotaka</h2>
<label>AKS (sistolinis) <input type="number" name="sistolinis" min="50" max="250"></label>
<label>AKS (diastolinis) <input type="number" name="diastolinis" min="20" max="150"></label>
<label>Pulsas (bpm) <input type="number" name="pulsas" min="30" max="200"></label>
<label>Kūno temperatūra (°C) <input type="number" step="0.1" name="temperatura" min="30" max="42"></label>
<label>Galvos svaigimas?
<select name="svaigimas"><option value="ne">Ne</option><option value="taip">Taip</option></select></label>
</div>

<!-- MITYBA -->
<div class="section">
<h2>Mityba</h2>
<label>Mitybos būdas:
<select name="mityba"><option value="burna">Per burną</option><option value="peg">Per PEG</option><option value="zondas">Per zondą</option></select></label>
<label>Rijimo sutrikimai?
<select name="rijimas"><option value="ne">Ne</option><option value="taip">Taip</option></select></label>
<label>Ar suvalgo visą maistą?
<select name="suvalgo"><option value="taip">Taip</option><option value="dalis">Dalis</option><option value="ne">Ne</option></select></label>
</div>

<!-- ŠALINIMAS -->
<div class="section">
<h2>Šalinimas</h2>
<label>Kateteris:
<select name="kateteris"><option value="nera">Nėra</option><option value="yra">Yra</option></select></label>
<label>Vidurių užkietėjimas?
<select name="viduriai"><option value="ne">Ne</option><option value="taip">Taip</option></select></label>
<label>Viduriavimas?
<select name="viduriavimas"><option value="ne">Ne</option><option value="taip">Taip</option></select></label>
</div>

<!-- JUDĖJIMAS -->
<div class="section">
<h2>Judėjimas</h2>
<label>Mobilumas:
<select name="mobilumas">
<option value="sav">Savarankiškas</option>
<option value="pagalba">Su pagalba</option>
<option value="lova">Lovos režimas</option>
</select></label>
</div>

<!-- MIEGAS -->
<div class="section">
<h2>Miegas</h2>
<label>Miego kokybė:
<select name="miegas"><option value="gera">Gera</option><option value="sutrikusi">Sutrikusi</option></select></label>
</div>

<!-- ODA -->
<div class="section">
<h2>Oda</h2>
<label>Pragulos:
<select name="pragulos"><option value="nera">Nėra</option><option value="yra">Yra</option></select></label>
<label>Žaizdos:
<select name="zaizdos" onchange="toggleZaizdosAprasymas(this)"><option value="nera">Nėra</option><option value="yra">Yra</option></select></label>
<div id="zaizdos_aprasymas" style="display:none;">
<label>Žaizdos aprašymas:</label>
<textarea name="zaizdos_text" rows="3"></textarea>
</div>
</div>

<!-- SKAUSMAS -->
<div class="section">
<h2>Skausmas</h2>
<label>Ar yra skausmas?
<select name="skausmas"><option value="ne">Ne</option><option value="taip">Taip</option></select></label>
<label>Intensyvumas (0-10) <input type="number" name="skausmoLygis" min="0" max="10"></label>
</div>

<button type="button" onclick="generateResults()">Generuoti</button>
</form>

<div class="results" id="results"></div>

<script>
function toggleZaizdosAprasymas(sel) {
    document.getElementById('zaizdos_aprasymas').style.display = (sel.value === "yra") ? "block" : "none";
}

const GOOGLE_SCRIPT_URL = "ĮRAŠYK_SAVO_WEBAPP_URL";

let slaugosPlanas = {
    "Kvėpavimo takai su tracheostominiu vamzdžiu": ["Savalaikis atsiurbimas iš tracheostominio vamzdelio","Vamzdelio drėkinimas"],
    "Nedidelis kraujavimas iš nosies": ["AKS stebėjimas kraujavimui nestojant","Pacientas apmokintas kaip prižiūrėti nosį kai kraujavimas sustos"],
    "Sutrikusi kvėpavimo funkcija (dusulys)": ["SpO₂ stebėjimas","Prireikus O₂ skyrimas pagal SpO₂"],
    "Neefektyvi dujų apykaita": ["SpO₂ stebėjimas","O₂ skyrimas ir reguliavimas pagal SpO₂ duomenis"],
    "Pažemėjęs kraujo spaudimas": ["Patarta neskubėti keltis iš lovos ir pasėdėti nuleidus kojas prieš einant","Stebėjimas dėl galimų griuvimų"],
    "Padidėjęs kraujo spaudimas": ["AKS tolimesnis sekimas kas 4 val."],
    "Sutrikusi mityba per burną": ["PEG perrišimas","Pagalba maitinantis"],
    "Rizika griuvimui dėl pagalbos poreikio": ["Stebėti dėl griuvimų rizikos"],
    "Rizika praguloms dėl lovos režimo": ["Paciento padėties keitimas kas 3 valandas","Pakišamų indų naudojimas / sauskelnės","Pagalbinių priemonių naudojimas","Odos vientisumo stebėjimas dėl pragulų rizikos"],
    "Pragulos": ["Paciento kūno padėties keitimas kas 3 valandas","Pagalbinių priemonių naudojimas","Pragulos perrišimas"],
    "Odos vientisumo pažeidimas (žaizda)": ["Žaizdos perrišimas","Stebėjimas dėl infekcijos"],
    "Ūmus/chroniškas skausmas": ["Savalaikis nuskausminimas"],
    "Padidėjusi temperatūra": ["Temperatūros stebėjimas"],
    "Hipotermija": ["Šilumos palaikymas","Temperatūros stebėjimas"]
};

let lastPayload = null;

function generateResults() {
    let f = document.forms['nursingForm'];
    let esamos = [];
    let galimos = [];

    // SpO₂ vertinimas
    if(f['saturacija'].value && f['saturacija'].value < 95) esamos.push("Neefektyvi dujų apykaita");

    // Temperatūros vertinimas
    let temp = parseFloat(f['temperatura'].value);
    if(temp){
        if(temp >= 37.1) esamos.push("Padidėjusi temperatūra");
        if(temp < 36.0) esamos.push("Hipotermija");
    }

    if(f['trach'].value==="taip") esamos.push("Kvėpavimo takai su tracheostominiu vamzdžiu");
    if(f['nosis'].value==="istraukti") esamos.push("Nedidelis kraujavimas iš nosies");
    if(f['dusulys'].value==="taip") esamos.push("Sutrikusi kvėpavimo funkcija (dusulys)");
    
    let sys=parseInt(f['sistolinis'].value), dia=parseInt(f['diastolinis'].value);
    if(sys && dia){
        if(sys<100 || dia<80) esamos.push("Pažemėjęs kraujo spaudimas");
        if(sys>139 || dia>95) esamos.push("Padidėjęs kraujo spaudimas");
    }
    
    if(f['mityba'].value!=="burna") esamos.push("Sutrikusi mityba per burną");
    if(f['mobilumas'].value==="lova") galimos.push("Rizika praguloms dėl lovos režimo");
    if(f['mobilumas'].value==="pagalba") galimos.push("Rizika griuvimui dėl pagalbos poreikio");
    if(f['pragulos'].value==="yra") esamos.push("Pragulos");
    if(f['zaizdos'].value==="yra"){let apr=f['zaizdos_text'].value.trim();esamos.push("Odos vientisumo pažeidimas (žaizda)"+(apr?" – "+apr:""));}
    if(f['skausmas'].value==="taip"){let val=f['skausmoLygis'].value;esamos.push(`Ūmus/chroniškas skausmas${val?" ("+val+"/10)":""}`);}

    // Rodome problemas
    let html = `<h3>Esamos problemos</h3><ul>${esamos.length?esamos.map(p=>`<li>${p}</li>`).join(''):"<li>Nepastebėta</li>"}</ul>`;
    html += `<h3>Galimos problemos</h3><ul>${galimos.length?galimos.map(p=>`<li>${p}</li>`).join(''):"<li>Nepastebėta</li>"}</ul>`;

    // Slaugos planas
    html += "<h3>Slaugos planas</h3>";
    esamos.concat(galimos).forEach(p=>{
        let key=Object.keys(slaugosPlanas).find(k=>p.startsWith(k));
        if(key){
            html += `<div class="planas"><h4>${p}</h4><ul>`;
            slaugosPlanas[key].forEach(i=>html += `<li>${i}</li>`);
            html += `</ul></div>`;
        }
    });

    // Gyvybinių rodiklių santrauka
    html += "<h3>Įvesti gyvybiniai rodikliai</h3>";
    html += `<p><strong>SpO₂:</strong> ${f['saturacija'].value || '-'} %<br>`;
    html += `<strong>AKS:</strong> ${f['sistolinis'].value || '-'} / ${f['diastolinis'].value || '-'} mmHg<br>`;
    html += `<strong>Širdies susitraukimų dažnis:</strong> ${f['pulsas'].value || '-'} / min<br>`;
    html += `<strong>Temperatūra:</strong> ${f['temperatura'].value || '-'} °C</p>`;

    // Mygtukai gale
    html += `<button type="button" onclick="keltiISistema()">Kelti į sistemą</button> 
             <button id="newPatientBtn" style="display:none;" onclick="location.reload()">Vertinti naują pacientą</button>`;

    document.getElementById('results').innerHTML = html;

    lastPayload = {
        data: new Date().toLocaleString(),
        palata: f['palata'].value,
        lova: f['lova'].value,
        esamos: esamos.join("; "),
        galimos: galimos.join("; "),
        spo2: f['saturacija'].value,
        aks: `${f['sistolinis'].value} / ${f['diastolinis'].value}`,
        pulsas: f['pulsas'].value,
        temperatura: f['temperatura'].value
    };
}

function keltiISistema(){
    if(!lastPayload){
        alert("Pirmiausia sugeneruokite rezultatą.");
        return;
    }
    fetch(GOOGLE_SCRIPT_URL,{
        method:"POST",
        mode:"no-cors",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(lastPayload)
    }).then(()=>{
        alert("✅ Duomenys įkelti sėkmingai!");
        document.getElementById('newPatientBtn').style.display = 'inline-block';
    }).catch(err=>{
        console.error(err);
        alert("❌ Klaida siunčiant į Google Sheets.");
    });
}
</script>

</body>
</html>
